<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AegisVCS<sub>local</sub> — Documentation</title>
  <meta name="description" content="A cryptographically secure repository & signed-commit system written in Rust" />

  <!-- Tailwind (via CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Prism for code highlighting + line numbers -->
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-rust.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>

  <style>
    :root{ --bg:#000; --panel: rgba(8,10,12,0.62); --muted: rgba(255,255,255,0.06); --accent: #34d399; }
    html,body{height:100%;}
    body{background:var(--bg); color:#e6eef8; font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;}
    #bg{position:fixed;inset:0;z-index:-10}
    aside{min-height:100vh}

    /* panels — translucent so animation shows through */
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.015)); border:1px solid rgba(255,255,255,0.03); backdrop-filter: blur(6px);}

    /* headings */
    h1,h2,h3{color:#e6f6ff}
    h3 .tag{color:var(--accent); font-weight:700}

    /* callouts */
    .callout{padding:0.75rem 1rem; border-radius:0.5rem; background:linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02)); border:1px solid rgba(255,255,255,0.02)}
    .callout.note{box-shadow: 0 4px 18px rgba(52,211,153,0.03);}
    .callout.warn{border-color: rgba(255,120,90,0.12); box-shadow: 0 6px 24px rgba(255,120,90,0.02);}

    /* code blocks: translucent gray bg and readable */
    pre.code-block{background: rgba(30,30,30,0.6); border-radius:0.5rem; padding:1rem; overflow:auto; border:1px solid rgba(255,255,255,0.03)}
    pre.code-block code { font-size:0.85rem; }

    /* Prism line numbers tweaks */
    .line-numbers .line-numbers-rows { opacity: 0.45 }

    /* table style for API params */
    table.api{width:100%; border-collapse:collapse; margin-top:.5rem}
    table.api th, table.api td{padding:.5rem .75rem; border-bottom:1px solid rgba(255,255,255,0.03); text-align:left}
    table.api th{background:rgba(255,255,255,0.01); color:#cfeffd}

    /* responsive */
    @media (max-width:900px){ aside{display:none} main{padding:1.5rem} }
  </style>
</head>
<body>
  <canvas id="bg"></canvas>

  <div class="min-h-screen flex">
    <aside class="w-72 p-6 border-r border-slate-800/40 bg-black/40 backdrop-blur-sm">
      <a class="flex items-center gap-3 mb-8" href="#">
        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-indigo-700 via-cyan-600 to-emerald-500 flex items-center justify-center shadow-xl">
          <span class="font-mono text-lg">AV</span>
        </div>
        <div>
          <h1 class="text-xl font-semibold">AegisVCS<sub>local</sub></h1>
          <p class="text-xs text-slate-400">Secure Version Control</p>
        </div>
      </a>

      <nav class="text-sm space-y-2">
        <a href="#overview" class="block px-3 py-2 rounded hover:bg-slate-800/20">Overview</a>
        <a href="#architecture" class="block px-3 py-2 rounded hover:bg-slate-800/20">Architecture</a>
        <a href="#design" class="block px-3 py-2 rounded hover:bg-slate-800/20">Design</a>
        <a href="#dependencies" class="block px-3 py-2 rounded hover:bg-slate-800/20">Dependencies</a>
        <a href="#structures" class="block px-3 py-2 rounded hover:bg-slate-800/20">Data Structures</a>
        <a href="#layout" class="block px-3 py-2 rounded hover:bg-slate-800/20">On-Disk Layout</a>
        <a href="#commands" class="block px-3 py-2 rounded hover:bg-slate-800/20">Commands</a>
        <a href="#security" class="block px-3 py-2 rounded hover:bg-slate-800/20">Security</a>
        <a href="#examples" class="block px-3 py-2 rounded hover:bg-slate-800/20">Examples</a>
      </nav>

      <div class="mt-6 text-xs text-slate-500">
        <p>Cryptographically secure VCS</p>
      </div>
    </aside>

    <main class="flex-1 p-10 max-w-5xl">
      <section id="overview" class="mb-6 panel p-6 rounded-lg">
        <h1 class="text-4xl font-bold mb-4">AegisVCS<sub>local</sub></h1>
        <p class="text-xl text-slate-300 mb-6">A cryptographically secure repository & signed-commit system written in Rust.</p>
        
        <div class="callout note">
          <strong class="text-slate-100">Core Features:</strong>
          <ul class="mt-2 text-slate-300 space-y-1">
            <li>• Ed25519 signed commits</li>
            <li>• Blake3 content hashing</li>
            <li>• Branching and merging</li>
            <li>• Full history verification</li>
            <li>• Lightweight storage</li>
          </ul>
        </div>
      </section>

      <section id="architecture" class="mb-6 panel p-6 rounded-lg">
        <h2 class="text-3xl font-bold mb-4">Architectural Diagram</h2>
        <div class="bg-slate-900/50 p-4 rounded-lg border border-slate-700/50 mb-4">
          <img src="architecture.svg" alt="Aegis Architecture Diagram" class="mx-auto max-w-full" />
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="callout">
            <h4 class="font-semibold text-emerald-400 mb-2">Components</h4>
            <ol class="list-decimal list-inside space-y-1 text-sm">
              <li><strong>User/CLI</strong>: Interface for user commands</li>
              <li><strong>Repo Manager</strong>: Core functionality handling operations</li>
              <li><strong>Index & Storage</strong>: Manages staged changes and object storage</li>
              <li><strong>Commit Creation</strong>: Creates cryptographically signed commits</li>
              <li><strong>Verification Path</strong>: Validates signatures and content integrity</li>
            </ol>
          </div>
          <div class="callout">
            <h4 class="font-semibold text-cyan-400 mb-2">Workflow</h4>
            <ol class="list-decimal list-inside space-y-1 text-sm">
              <li>Commands enter through CLI</li>
              <li>Repo Manager coordinates operations</li>
              <li>Objects stored in content-addressable storage</li>
              <li>Commits are signed before storage</li>
              <li>All objects can be verified later</li>
            </ol>
          </div>
        </div>
      </section>

      <section id="design" class="mb-6 panel p-6 rounded-lg">
        <h2 class="text-3xl font-bold mb-4">High-Level Design</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h3 class="text-xl font-semibold mb-3 text-emerald-400">Commit Lifecycle</h3>
            <ol class="list-decimal list-inside space-y-2">
              <li><strong>Scan</strong> working directory to create content index (file paths → file hashes)</li>
              <li><strong>Create Commit Object</strong>: Contains metadata, snapshot hash, and parent(s)</li>
              <li><strong>Sign</strong>: Ed25519 signature over serialized commit data</li>
              <li><strong>Store</strong>: Commits and blobs to disk</li>
              <li><strong>Reference</strong>: Commits by base58-encoded IDs</li>
              <li><strong>Verify</strong>: Re-hash content and verify signature against stored public key</li>
            </ol>
          </div>
          <div>
            <h3 class="text-xl font-semibold mb-3 text-cyan-400">Security Model</h3>
            <ul class="space-y-2">
              <li class="flex items-start">
                <span class="inline-block bg-emerald-900/50 text-emerald-400 rounded-full p-1 mr-2">✓</span>
                <span>All commits cryptographically signed by default</span>
              </li>
              <li class="flex items-start">
                <span class="inline-block bg-emerald-900/50 text-emerald-400 rounded-full p-1 mr-2">✓</span>
                <span>Keypair generated during <code>aegis init</code></span>
              </li>
              <li class="flex items-start">
                <span class="inline-block bg-emerald-900/50 text-emerald-400 rounded-full p-1 mr-2">✓</span>
                <span>Automatic signature verification during <code>aegis verify</code></span>
              </li>
              <li class="flex items-start">
                <span class="inline-block bg-emerald-900/50 text-emerald-400 rounded-full p-1 mr-2">✓</span>
                <span>UID derived from public key to prevent impersonation</span>
              </li>
            </ul>
          </div>
        </div>
      </section>

      <section id="dependencies" class="mb-6 panel p-6 rounded-lg">
        <h2 class="text-3xl font-bold mb-4">Dependencies</h2>
        <div class="overflow-x-auto">
          <table class="api w-full">
            <thead>
              <tr>
                <th>Crate</th>
                <th>Purpose</th>
                <th>Key Features</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>anyhow</code></td>
                <td>Error handling</td>
                <td>Ergonomic error contexts</td>
              </tr>
              <tr>
                <td><code>base58</code></td>
                <td>Encoding</td>
                <td>Human-friendly IDs</td>
              </tr>
              <tr>
                <td><code>blake3</code></td>
                <td>Hashing</td>
                <td>Fast cryptographic hashing</td>
              </tr>
              <tr>
                <td><code>chrono</code></td>
                <td>Timestamps</td>
                <td>Commit timing</td>
              </tr>
              <tr>
                <td><code>ed25519_dalek</code></td>
                <td>Crypto</td>
                <td>Keypair generation/signing</td>
              </tr>
              <tr>
                <td><code>rand</code></td>
                <td>Randomness</td>
                <td>Key generation</td>
              </tr>
              <tr>
                <td><code>serde</code></td>
                <td>Serialization</td>
                <td>Data persistence</td>
              </tr>
              <tr>
                <td><code>walkdir</code></td>
                <td>Filesystem</td>
                <td>Recursive traversal</td>
              </tr>
              <tr>
                <td><code>whoami</code></td>
                <td>System</td>
                <td>User identification</td>
              </tr>
              <tr>
                <td><code>thiserror</code></td>
                <td>Errors</td>
                <td>Custom error derivation</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section id="structures" class="mb-6 panel p-6 rounded-lg">
        <h2 class="text-3xl font-bold mb-4">Data Structures</h2>
        
        <article class="mb-8">
          <h3 class="text-2xl font-semibold mb-3 text-emerald-400">Commit</h3>
          <pre class="code-block"><code class="language-rust">#[derive(Serialize, Deserialize, Debug, Clone)]
struct Commit {
    id: String,                 // Commit ID (blake3 hash)
    parents: Vec&lt;String&gt;,        // Parent commit IDs
    timestamp: DateTime&lt;Utc&gt;,    // Creation time
    author: Author,              // Committer identity
    tree_hash: String,           // Snapshot of all files
    changes: Changes,            // Added/modified/deleted files
    message: String,             // Commit message
    signature: String,           // Ed25519 signature (base58)
    public_key: String,          // Public key (base58)
}</code></pre>
          <div class="callout mt-3">
            <strong>Key Fields:</strong>
            <ul class="mt-1 space-y-1">
              <li><code>id</code>: Content-derived identifier</li>
              <li><code>signature</code>: Ed25519 signature of commit data</li>
              <li><code>tree_hash</code>: Root hash of repository state</li>
            </ul>
          </div>
        </article>

        <article class="mb-8">
          <h3 class="text-2xl font-semibold mb-3 text-cyan-400">Repository</h3>
          <pre class="code-block"><code class="language-rust">struct Repository {
    path: PathBuf,              // Root directory
    aegis_dir: PathBuf,         // .aegis directory
    signing_key: SigningKey,    // Ed25519 signing key
    current_branch: String,     // Active branch
    config: Config,             // Repository configuration
}</code></pre>
        </article>

        <article>
          <h3 class="text-2xl font-semibold mb-3 text-purple-400">Config</h3>
          <pre class="code-block"><code class="language-rust">struct Config {
    hash_algorithm: String,     // "blake3"
    signature_algorithm: String,// "ed25519"
    uid_length: usize,          // 12
    ignore_patterns: Vec&lt;String&gt;, // [".aegis", "target", ...]
}</code></pre>
        </article>
      </section>

      <section id="layout" class="mb-6 panel p-6 rounded-lg">
        <h2 class="text-3xl font-bold mb-4">On-Disk Layout</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <pre class="code-block"><code class="language-plaintext">.aegis/
├── branches/       # Branch references
├── commits/        # Commit objects
├── config.yaml     # Repository config
├── current_branch  # Active branch name
├── hooks/          # Client-side hooks
├── index           # Staging area
├── keypair.bin     # Ed25519 keypair
├── objects/        # File blobs
├── reflog/         # Reference logs
├── stashes/        # Stashed changes
└── trees/          # Directory structures</code></pre>
          </div>
          <div>
            <div class="callout">
              <h4 class="font-semibold mb-2">Storage Notes</h4>
              <ul class="space-y-2 text-sm">
                <li>• All objects stored by content hash</li>
                <li>• Commits stored as signed YAML</li>
                <li>• Keys protected by filesystem permissions</li>
                <li>• Index tracks working directory state</li>
                <li>• Reflog preserves reference history</li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <section id="commands" class="mb-6 panel p-6 rounded-lg">
        <h2 class="text-3xl font-bold mb-4">Command-Line Usage</h2>
        
        <h3 class="text-2xl font-semibold mb-3 text-emerald-400">Core Commands</h3>
        <div class="overflow-x-auto">
          <table class="api">
            <thead>
              <tr>
                <th>Command</th>
                <th>Description</th>
                <th>Internal Workflow</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>init</code></td>
                <td>Initialize repository</td>
                <td>1. Create <code>.aegis</code> structure<br>2. Generate Ed25519 keypair<br>3. Create initial <code>main</code> branch<br>4. Set up default ignore patterns</td>
              </tr>
              <tr>
                <td><code>add &lt;path&gt;</code></td>
                <td>Stage files</td>
                <td>1. Check pre-add hook<br>2. Hash file contents with blake3<br>3. Update index with file hashes<br>4. Run post-add hook</td>
              </tr>
              <tr>
                <td><code>commit &lt;message&gt;</code></td>
                <td>Create commit</td>
                <td>1. Run pre-commit hook<br>2. Compute changes from previous commit<br>3. Create signed commit object<br>4. Store commit and update HEAD<br>5. Print commit summary<br>6. Run post-commit hook</td>
              </tr>
              <tr>
                <td><code>status</code></td>
                <td>Show changes</td>
                <td>1. Compare working tree to index<br>2. Compare index to HEAD commit<br>3. Display changes in three categories</td>
              </tr>
              <tr>
                <td><code>log</code></td>
                <td>Show history</td>
                <td>1. Start from HEAD commit<br>2. Traverse parent commits<br>3. Display commit metadata<br>4. Limit to last 50 commits</td>
              </tr>
              <tr>
                <td><code>verify [commit]</code></td>
                <td>Verify signatures</td>
                <td>1. Load commit object<br>2. Decode base58 public key<br>3. Verify Ed25519 signature<br>4. Validate content hash</td>
              </tr>
            </tbody>
          </table>
        </div>

        <h3 class="text-2xl font-semibold mt-8 mb-3 text-cyan-400">Branching & Merging</h3>
        <div class="overflow-x-auto">
          <table class="api">
            <thead>
              <tr>
                <th>Command</th>
                <th>Description</th>
                <th>Internal Workflow</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>branch [name]</code></td>
                <td>List/create branch</td>
                <td>1. List existing branches<br>2. Create new branch at current commit<br>3. Sign branch reference</td>
              </tr>
              <tr>
                <td><code>checkout &lt;target&gt;</code></td>
                <td>Switch context</td>
                <td>1. Run pre-checkout hook<br>2. Update HEAD reference<br>3. Reset working tree<br>4. Add reflog entry<br>5. Run post-checkout hook</td>
              </tr>
              <tr>
                <td><code>merge &lt;branch&gt;</code></td>
                <td>Merge branches</td>
                <td>1. Find common ancestor<br>2. Detect file conflicts<br>3. Create merge commit with two parents<br>4. Update current branch reference</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
          <div>
            <h3 class="text-xl font-semibold mb-3 text-purple-400">Tagging</h3>
            <table class="api">
              <tr>
                <td><code>tag &lt;name&gt; [msg]</code></td>
                <td>Create signed tag at current commit</td>
              </tr>
              <tr>
                <td><code>tag -l</code></td>
                <td>List all tags</td>
              </tr>
            </table>
          </div>
          <div>
            <h3 class="text-xl font-semibold mb-3 text-amber-400">Stashing</h3>
            <table class="api">
              <tr>
                <td><code>stash [msg]</code></td>
                <td>Save current changes to stash</td>
              </tr>
              <tr>
                <td><code>stash apply</code></td>
                <td>Apply latest stash</td>
              </tr>
            </table>
          </div>
        </div>
      </section>

      <section id="security" class="mb-6 panel p-6 rounded-lg">
        <h2 class="text-3xl font-bold mb-4">Security Considerations</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h3 class="text-xl font-semibold mb-3 text-emerald-400">Protections</h3>
            <ul class="space-y-3">
              <li class="flex items-start">
                <span class="inline-block bg-emerald-900/50 text-emerald-400 rounded-full p-1 mr-2">✓</span>
                <div>
                  <strong>Key Protection</strong>
                  <p class="text-sm text-slate-300">Private keys stored in <code>keypair.bin</code> with strict file permissions</p>
                </div>
              </li>
              <li class="flex items-start">
                <span class="inline-block bg-emerald-900/50 text-emerald-400 rounded-full p-1 mr-2">✓</span>
                <div>
                  <strong>Signature Verification</strong>
                  <p class="text-sm text-slate-300">All operations verify signatures before trusting objects</p>
                </div>
              </li>
              <li class="flex items-start">
                <span class="inline-block bg-emerald-900/50 text-emerald-400 rounded-full p-1 mr-2">✓</span>
                <div>
                  <strong>Immutable History</strong>
                  <p class="text-sm text-slate-300">Signed commits prevent history tampering</p>
                </div>
              </li>
            </ul>
          </div>
          <div>
            <h3 class="text-xl font-semibold mb-3 text-cyan-400">Implementation</h3>
            <div class="callout">
              <h4 class="font-semibold">UID Generation</h4>
              <p class="text-sm mt-1">User IDs derived from public keys prevent impersonation:</p>
              <pre class="code-block mt-2"><code class="language-rust">fn get_public_uid(&self) -> String {
    let hash = blake3::hash(
        self.signing_key.verifying_key().as_bytes()
    );
    hash.as_bytes()[..8].to_base58()
}</code></pre>
            </div>
          </div>
        </div>
      </section>

      <section id="examples" class="mb-6 panel p-6 rounded-lg">
        <h2 class="text-3xl font-bold mb-4">Examples</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h3 class="text-xl font-semibold mb-3 text-emerald-400">Basic Workflow</h3>
            <pre class="code-block"><code class="language-bash"># Initialize repository
aegis init

# Make first commit
aegis add .
aegis commit "Initial commit"

# Create feature branch
aegis branch feature-x
aegis checkout feature-x

# Verify commit history
aegis log
aegis verify HEAD</code></pre>
          </div>
          <div>
            <h3 class="text-xl font-semibold mb-3 text-cyan-400">Advanced Usage</h3>
            <pre class="code-block"><code class="language-bash"># Merge changes
aegis checkout main
aegis merge feature-x

# Revert mistake
aegis revert abcd1234

# Stash changes
aegis stash "WIP: experiment"
aegis stash apply

# Create signed tag
aegis tag v1.0 "Release version"</code></pre>
          </div>
        </div>
      </section>

      <footer class="mt-8 text-sm text-slate-400">© <span id="year"></span> AegisVCS — Secure Version Control System</footer>
    </main>
  </div>

  <script>
    // set footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Background canvas (space-time curvature + ripples + matrix)
    (function(){
      const canvas = document.getElementById('bg');
      const ctx = canvas.getContext('2d');
      let W=0,H=0,cx=0,cy=0;

      function resize(){ W=canvas.width=innerWidth; H=canvas.height=innerHeight; cx=W/2; cy=H/2; createStars(); createDrops(); }
      addEventListener('resize', resize);

      function rand(a,b){return Math.random()*(b-a)+a}

      let stars=[];
      function createStars(){ stars=[]; const STAR_COUNT = Math.floor((W*H)/12000)+60; for(let i=0;i<STAR_COUNT;i++){ stars.push({x:Math.random()*W,y:Math.random()*H,z:rand(0.2,1),size:rand(0.3,1.4)}); } }

      let cols=10, drops=[];
      const chars = 'ア カ サ タ ナ ハ マ ヤ ラ ワ 0 1 2 3 4 5 6 7 8 9'.split(' ');
      function createDrops(){ cols = Math.max(10, Math.floor(W/16)); drops = new Array(cols).fill(0).map(()=>Math.floor(Math.random()*H)); }

      const ripples = [];
      function pushRipple(x,y){ ripples.push({x,y,t:0,dur:120}); }
      addEventListener('mousemove', (e)=>{ if(Math.random()>0.98) pushRipple(e.clientX,e.clientY); });
      addEventListener('click', (e)=> pushRipple(e.clientX,e.clientY));

      resize();
      let frame=0;
      function loop(){
        frame++; ctx.clearRect(0,0,W,H);
        const grad = ctx.createRadialGradient(cx,cy,10,cx,cy,Math.max(W,H));
        grad.addColorStop(0,'rgba(10,14,30,0.6)'); grad.addColorStop(0.35,'rgba(6,8,16,0.6)'); grad.addColorStop(1,'rgba(0,0,0,0.95)');
        ctx.fillStyle=grad; ctx.fillRect(0,0,W,H);

        // stars warped
        for(const s of stars){ s.y += 0.25 + s.z*0.8; if(s.y>H+20){ s.y=-10; s.x=Math.random()*W; } const dy=(s.y-cy)/H; const warp=1+(dy*dy)*2.2; const wx=(s.x-cx)*warp+cx; const alpha=0.6*s.z; ctx.fillStyle=`rgba(180,220,255,${alpha})`; ctx.fillRect(wx,s.y,s.size*1.2,s.size*1.2); }

        // streaks
        for(let i=0;i<6;i++){ ctx.beginPath(); ctx.lineWidth=0.6+i*0.1; ctx.strokeStyle=`rgba(80,140,255,${0.02+i*0.01})`; const offset=(frame*0.35+i*60)%(W*2)-W; ctx.moveTo(offset,0); ctx.quadraticCurveTo(cx, cy+(i-3)*30, offset+W*0.4, H); ctx.stroke(); }

        // ripples
        for(let i=ripples.length-1;i>=0;i--){ const r=ripples[i]; r.t++; const p=r.t/r.dur; if(p>1){ ripples.splice(i,1); continue;} const radius=p*Math.max(W,H)*0.1; const alpha=(1-p)*0.6; ctx.beginPath(); ctx.strokeStyle=`rgba(120,180,255,${alpha})`; ctx.lineWidth=1.2+p*3; ctx.arc(r.x,r.y,radius,0,Math.PI*2); ctx.stroke(); for(let k=1;k<3;k++){ const rr=radius*(0.35+k*0.25); ctx.beginPath(); ctx.strokeStyle=`rgba(120,180,255,${alpha*0.12*k})`; ctx.lineWidth=0.6; ctx.arc(r.x,r.y,rr,0,Math.PI*2); ctx.stroke(); } }

        // matrix
        ctx.font='14px monospace'; ctx.globalCompositeOperation='lighter'; for(let c=0;c<cols;c++){ const x=c*16; const drop=drops[c]; const ch=chars[(Math.floor(frame/2)+c)%chars.length]; ctx.fillStyle='rgba(60,255,140,0.06)'; ctx.fillText(ch,x,drop); drops[c]= drop>H+Math.random()*100?0:drop+14+Math.random()*8; } ctx.globalCompositeOperation='source-over';

        // center lens
        const r2=Math.max(W,H)*0.02; const g2=ctx.createRadialGradient(cx,cy,1,cx,cy,r2); g2.addColorStop(0,'rgba(120,170,255,0.12)'); g2.addColorStop(1,'rgba(0,0,0,0)'); ctx.fillStyle=g2; ctx.beginPath(); ctx.arc(cx,cy,r2,0,Math.PI*2); ctx.fill();

        requestAnimationFrame(loop);
      }
      requestAnimationFrame(loop);
    })();
  </script>
</body>
</html>
